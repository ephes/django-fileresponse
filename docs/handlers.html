---

title: ASGIHandlers


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/01_handlers.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_handlers.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AsyncFileASGIHandler" class="doc_header"><code>class</code> <code>AsyncFileASGIHandler</code><a href="https://github.com/ephes/django_fileresponse/tree/main/fileresponse/handlers.py#L11" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>AsyncFileASGIHandler</code>() :: <code>ASGIHandler</code></p>
</blockquote>
<p>Handler for ASGI requests.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tests">Tests<a class="anchor-link" href="#Tests"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Response</span><span class="p">:</span>
    <span class="n">cookies</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">streaming</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">status_code</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">stream_called</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">is_async_fileresponse</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="p">[</span><span class="n">content</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">is_async_fileresponse</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_async_fileresponse</span> <span class="o">=</span> <span class="n">is_async_fileresponse</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">send</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_called</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">send</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="k">def</span> <span class="nf">get_send</span><span class="p">(</span><span class="n">received</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">received</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">send</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="68996557-5e00-4fe2-aafe-00133d66a415"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#68996557-5e00-4fe2-aafe-00133d66a415');

            setTimeout(function() {
                var nbb_cell_id = 6;
                var nbb_unformatted_code = "class Response:\n    cookies = {}\n    streaming = True\n    status_code = 200\n    stream_called = False\n\n    def __init__(self, content, is_async_fileresponse=None):\n        self.index = -1\n        self.contents = [content]\n        if is_async_fileresponse is not None:\n            self.is_async_fileresponse = is_async_fileresponse\n\n    async def stream(self, send):\n        self.stream_called = True\n        for content in self.contents:\n            await send(content)\n\n    def __iter__(self):\n        return self\n\n    def __next__(self):\n        self.index += 1\n        try:\n            return self.contents[self.index]\n        except IndexError:\n            raise StopIteration\n\n    def items(self):\n        return []\n\n    def close(self):\n        pass\n\n\ndef get_send(received):\n    async def send(data):\n        received.append(data)\n    \n    return send";
                var nbb_formatted_code = "class Response:\n    cookies = {}\n    streaming = True\n    status_code = 200\n    stream_called = False\n\n    def __init__(self, content, is_async_fileresponse=None):\n        self.index = -1\n        self.contents = [content]\n        if is_async_fileresponse is not None:\n            self.is_async_fileresponse = is_async_fileresponse\n\n    async def stream(self, send):\n        self.stream_called = True\n        for content in self.contents:\n            await send(content)\n\n    def __iter__(self):\n        return self\n\n    def __next__(self):\n        self.index += 1\n        try:\n            return self.contents[self.index]\n        except IndexError:\n            raise StopIteration\n\n    def items(self):\n        return []\n\n    def close(self):\n        pass\n\n\ndef get_send(received):\n    async def send(data):\n        received.append(data)\n\n    return send";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Happy-Path">Happy Path<a class="anchor-link" href="#Happy-Path"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">AsyncFileASGIHandler</span><span class="p">()</span>
<span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;&lt;h1&gt;Content!&lt;/h1&gt;&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">is_async_fileresponse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">received</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">send</span> <span class="o">=</span> <span class="n">get_send</span><span class="p">(</span><span class="n">received</span><span class="p">)</span>
<span class="k">await</span> <span class="n">app</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">send</span><span class="p">)</span>
<span class="n">returned_content</span> <span class="o">=</span> <span class="n">received</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">stream_called</span>
<span class="k">assert</span> <span class="n">content</span> <span class="o">==</span> <span class="n">returned_content</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="f8c9f497-7f9c-4ad5-a377-eb039d188869"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#f8c9f497-7f9c-4ad5-a377-eb039d188869');

            setTimeout(function() {
                var nbb_cell_id = 7;
                var nbb_unformatted_code = "app = AsyncFileASGIHandler()\ncontent = \"<h1>Content!</h1>\"\nresponse = Response(content, is_async_fileresponse=True)\nreceived = []\nsend = get_send(received)\nawait app.send_response(response, send)\nreturned_content = received[0]\nassert response.stream_called\nassert content == returned_content";
                var nbb_formatted_code = "app = AsyncFileASGIHandler()\ncontent = \"<h1>Content!</h1>\"\nresponse = Response(content, is_async_fileresponse=True)\nreceived = []\nsend = get_send(received)\nawait app.send_response(response, send)\nreturned_content = received[0]\nassert response.stream_called\nassert content == returned_content";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Response-Without-is_async_fileresponse-attribute">Response Without is_async_fileresponse attribute<a class="anchor-link" href="#Response-Without-is_async_fileresponse-attribute"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">AsyncFileASGIHandler</span><span class="p">()</span>
<span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;&lt;h1&gt;Content!&lt;/h1&gt;&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<span class="n">received</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">send</span> <span class="o">=</span> <span class="n">get_send</span><span class="p">(</span><span class="n">received</span><span class="p">)</span>
<span class="k">await</span> <span class="n">app</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">send</span><span class="p">)</span>
<span class="n">returned_content</span> <span class="o">=</span> <span class="n">received</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;body&quot;</span><span class="p">]</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">stream_called</span>
<span class="k">assert</span> <span class="n">content</span> <span class="o">==</span> <span class="n">returned_content</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="56d6766e-2dc6-48f4-bdcb-6aec229a3ded"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#56d6766e-2dc6-48f4-bdcb-6aec229a3ded');

            setTimeout(function() {
                var nbb_cell_id = 8;
                var nbb_unformatted_code = "app = AsyncFileASGIHandler()\ncontent = \"<h1>Content!</h1>\"\nresponse = Response(content)\nreceived = []\nsend = get_send(received)\nawait app.send_response(response, send)\nreturned_content = received[1][\"body\"]\nassert not response.stream_called\nassert content == returned_content";
                var nbb_formatted_code = "app = AsyncFileASGIHandler()\ncontent = \"<h1>Content!</h1>\"\nresponse = Response(content)\nreceived = []\nsend = get_send(received)\nawait app.send_response(response, send)\nreturned_content = received[1][\"body\"]\nassert not response.stream_called\nassert content == returned_content";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

